<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Physical activity calculator manual</title>
  <meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
  <meta name="description" content="This is a minimal example of using the bookdown package to write a book. The output format for this example is bookdown::gitbook.">
  <meta name="generator" content="bookdown 0.3 and GitBook 2.6.7">

  <meta property="og:title" content="Physical activity calculator manual" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is a minimal example of using the bookdown package to write a book. The output format for this example is bookdown::gitbook." />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Physical activity calculator manual" />
  
  <meta name="twitter:description" content="This is a minimal example of using the bookdown package to write a book. The output format for this example is bookdown::gitbook." />
  

<meta name="author" content="Epiandes">


<meta name="date" content="2017-01-22">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="required-packages.html">
<link rel="next" href="script-output.html">

<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />










</head>

<body>


  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#table-of-contents"><i class="fa fa-check"></i><b>1.1</b> Table of contents</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="RnRstudio.html"><a href="RnRstudio.html"><i class="fa fa-check"></i><b>2</b> R and RStudio</a><ul>
<li class="chapter" data-level="2.1" data-path="RnRstudio.html"><a href="RnRstudio.html#r"><i class="fa fa-check"></i><b>2.1</b> R</a></li>
<li class="chapter" data-level="2.2" data-path="RnRstudio.html"><a href="RnRstudio.html#rstudio"><i class="fa fa-check"></i><b>2.2</b> RStudio</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="required-packages.html"><a href="required-packages.html"><i class="fa fa-check"></i><b>3</b> Required packages</a></li>
<li class="chapter" data-level="4" data-path="how-to-use-this-code.html"><a href="how-to-use-this-code.html"><i class="fa fa-check"></i><b>4</b> How to use this code?</a><ul>
<li class="chapter" data-level="4.1" data-path="how-to-use-this-code.html"><a href="how-to-use-this-code.html#set-the-working-directory"><i class="fa fa-check"></i><b>4.1</b> Set the working directory</a></li>
<li class="chapter" data-level="4.2" data-path="how-to-use-this-code.html"><a href="how-to-use-this-code.html#load-required-libraries"><i class="fa fa-check"></i><b>4.2</b> Load required libraries</a></li>
<li class="chapter" data-level="4.3" data-path="how-to-use-this-code.html"><a href="how-to-use-this-code.html#load-functions"><i class="fa fa-check"></i><b>4.3</b> Load functions</a></li>
<li class="chapter" data-level="4.4" data-path="how-to-use-this-code.html"><a href="how-to-use-this-code.html#set-global-parameters"><i class="fa fa-check"></i><b>4.4</b> Set global parameters</a></li>
<li class="chapter" data-level="4.5" data-path="how-to-use-this-code.html"><a href="how-to-use-this-code.html#load-and-run-the-main-function"><i class="fa fa-check"></i><b>4.5</b> Load and run the main function</a><ul>
<li class="chapter" data-level="4.5.1" data-path="how-to-use-this-code.html"><a href="how-to-use-this-code.html#read-data-form-the-.agd-files-sqlite-databases"><i class="fa fa-check"></i><b>4.5.1</b> Read data form the .agd files (SQLite databases)</a></li>
<li class="chapter" data-level="4.5.2" data-path="how-to-use-this-code.html"><a href="how-to-use-this-code.html#quality-control-checks"><i class="fa fa-check"></i><b>4.5.2</b> Quality control checks</a></li>
<li class="chapter" data-level="4.5.3" data-path="how-to-use-this-code.html"><a href="how-to-use-this-code.html#data-aggregation"><i class="fa fa-check"></i><b>4.5.3</b> Data aggregation</a></li>
<li class="chapter" data-level="4.5.4" data-path="how-to-use-this-code.html"><a href="how-to-use-this-code.html#sleep-period-identification"><i class="fa fa-check"></i><b>4.5.4</b> Sleep period identification</a></li>
<li class="chapter" data-level="4.5.5" data-path="how-to-use-this-code.html"><a href="how-to-use-this-code.html#non-wear-period-identification"><i class="fa fa-check"></i><b>4.5.5</b> Non-wear period identification</a></li>
<li class="chapter" data-level="4.5.6" data-path="how-to-use-this-code.html"><a href="how-to-use-this-code.html#wear-periods-check"><i class="fa fa-check"></i><b>4.5.6</b> Wear periods check</a></li>
<li class="chapter" data-level="4.5.7" data-path="how-to-use-this-code.html"><a href="how-to-use-this-code.html#cleaning-remove-last-day-of-data-and-more-than-7-days-of-data"><i class="fa fa-check"></i><b>4.5.7</b> Cleaning (Remove last day of data and more than 7 days of data)</a></li>
<li class="chapter" data-level="4.5.8" data-path="how-to-use-this-code.html"><a href="how-to-use-this-code.html#add-intensity-physical-activity"><i class="fa fa-check"></i><b>4.5.8</b> Add intensity physical activity</a></li>
<li class="chapter" data-level="4.5.9" data-path="how-to-use-this-code.html"><a href="how-to-use-this-code.html#get-the-datafile-observation-for-the-final-data-frame-only-wear-periods"><i class="fa fa-check"></i><b>4.5.9</b> Get the datafile observation for the final data frame (only wear periods)</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="script-output.html"><a href="script-output.html"><i class="fa fa-check"></i><b>5</b> Script output</a><ul>
<li class="chapter" data-level="5.1" data-path="script-output.html"><a href="script-output.html#log-file"><i class="fa fa-check"></i><b>5.1</b> Log file</a></li>
<li class="chapter" data-level="5.2" data-path="script-output.html"><a href="script-output.html#codebook"><i class="fa fa-check"></i><b>5.2</b> Codebook</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="extra.html"><a href="extra.html"><i class="fa fa-check"></i><b>6</b> Extra</a><ul>
<li class="chapter" data-level="6.1" data-path="extra.html"><a href="extra.html#multiple-files"><i class="fa fa-check"></i><b>6.1</b> Multiple files</a></li>
<li class="chapter" data-level="6.2" data-path="extra.html"><a href="extra.html#analyzing-outout"><i class="fa fa-check"></i><b>6.2</b> Analyzing outout</a></li>
<li class="chapter" data-level="6.3" data-path="extra.html"><a href="extra.html#example"><i class="fa fa-check"></i><b>6.3</b> Example</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="final-words.html"><a href="final-words.html"><i class="fa fa-check"></i><b>7</b> Final Words</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Physical activity calculator manual</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="how-to-use-this-code" class="section level1">
<h1><span class="header-section-number">4</span> How to use this code?</h1>
<p>In order to use the code, the R file <strong><em>ac_protocol.R</em></strong> have to be edited. The code holds five important components: <em>Working directory</em>, <em>Required libraries</em>, <em>Functions</em>, <em>Global parameters</em> and <em>Main routine</em>. In this section, the description of those components is presented.</p>
<div id="set-the-working-directory" class="section level2">
<h2><span class="header-section-number">4.1</span> Set the working directory</h2>
<p>The working directory (wd) is the folder which stores the R code, the input data and the code’s output data. Likewise, the wd folder must contain the following folders:</p>
<ul>
<li><strong>R</strong>: The code is stored in this folder.</li>
<li><strong>data</strong>: Contains all the .agd files to be processed.</li>
<li><strong>output</strong>: The final data frame and a log will be stored in this folder.</li>
</ul>
<p>Line 5 sets the working directory.</p>
</div>
<div id="load-required-libraries" class="section level2">
<h2><span class="header-section-number">4.2</span> Load required libraries</h2>
<p>Starting at line 9, the lines load all the required libraries. Those libraries must be installed before running the code; otherwise, an error message will be printed on Console.</p>
<pre><code>Error in library(&quot;Hmisc&quot;) : there is no package called ‘Hmisc’</code></pre>
<p>The reader may refer back to <em>Requiered libraries</em> section for more information.</p>
</div>
<div id="load-functions" class="section level2">
<h2><span class="header-section-number">4.3</span> Load functions</h2>
<p>From line 20 until 446, all the functions are declared. Those function must be loaded in the <em>Workspace</em> to run the main routine.</p>
</div>
<div id="set-global-parameters" class="section level2">
<h2><span class="header-section-number">4.4</span> Set global parameters</h2>
<p>Before the main routine, a set of global parameters must be fixed.</p>
<ul>
<li><strong>inputdir</strong>: Input data folder directory.</li>
<li><strong>outputdir</strong>: Output folder directory.</li>
<li><strong>outputfile</strong>: Output .csv file name.</li>
<li><strong>packdir</strong>: Pack file directory. This file must be a .xlsx file and must have the same format as in the example.</li>
<li><strong>sheets</strong>: Sheets contained within the Pack file.</li>
</ul>
</div>
<div id="load-and-run-the-main-function" class="section level2">
<h2><span class="header-section-number">4.5</span> Load and run the main function</h2>
<p>In the main function, you should fix the values for the functions parameters. In the framework, the values defined as parameters are those described in the paper <em>Collection, Management and Treatment in the International Study of Children’s Obesity, Lifestyle and Environment (ISCOLE)</em>; however, the reader is free to modify them as their needs.</p>
<p>The main function is composed of nine blocks:</p>
<div id="read-data-form-the-.agd-files-sqlite-databases" class="section level3">
<h3><span class="header-section-number">4.5.1</span> Read data form the .agd files (SQLite databases)</h3>
<p>The following block reads the database (.agd file) using the file directory <code>dbDir</code> and save the accelerometry data on the variable <code>data</code> and all the settings parameters on the variable <code>settings</code>.</p>
<pre><code>db &lt;- readDatabase(dbDir)
data &lt;- db$data
settings &lt;- db$settings</code></pre>
</div>
<div id="quality-control-checks" class="section level3">
<h3><span class="header-section-number">4.5.2</span> Quality control checks</h3>
<p>This line performs all the quality control checks and receives as parameters the file directory, the accelerometry data, the settings and the pack data frame.</p>
<pre><code>valid &lt;- qualityControlCheck(dbDir,data, settings, pack)</code></pre>
</div>
<div id="data-aggregation" class="section level3">
<h3><span class="header-section-number">4.5.3</span> Data aggregation</h3>
<p>In this block the data is aggregated in 15sec epoch and 60sec epoch. In addition, an activity column is added to both data frames (all epochs are marked as “wear/wake”).</p>
<pre><code>data15 &lt;- aggregation(15, data)
data60 &lt;- aggregation(60, data)
data15$activity &lt;- rep(&quot;wear&quot;,nrow(data15)) #Activity (sleep, non-wear, wear/wake)
data60$activity &lt;- rep(&quot;wear&quot;,nrow(data60)) #Activity (sleep, non-wear, wear/wake)</code></pre>
</div>
<div id="sleep-period-identification" class="section level3">
<h3><span class="header-section-number">4.5.4</span> Sleep period identification</h3>
<p>The function <code>sleepPeriods</code> identifies all the sleep periods and the non-wear periods within the sleep periods. As output, it returns a list with the sleep and non-wear periods. This function receives as parameter:</p>
<ul>
<li>**<a href="data:**" class="uri">data:**</a> The data frame to identified the sleep periods (if epoch &lt; 60sec, the data is aggregate to 60sec epoch).</li>
<li><strong>sleepOnsetHours:</strong> Range of day hours in which a sleep period can start.</li>
<li><strong>bedTimemin:</strong> Number of consecutive minutes to start a sleep period.</li>
<li><strong>minSleepTime:</strong> Minimum sleep period length (in minutes).</li>
<li><strong>tolMatrix:</strong> Tolerance matrix. Consecutive minutes of non-sleep to declare the end of a sleep period. The minutes may differ between range of hours.</li>
<li><strong>tolBsleepMatrix:</strong> Tolerance matrix before identifying a sleep period. Consecutive minutes of non-sleep to declare the end of a sleep period. The minutes may differ between range of hours.</li>
<li><strong>scanParam:</strong> Scan parameter to identify the sleep minutes using Sadeh et al. (1994) algorithm (axis1, axis2, axis3 or vm).</li>
<li><strong>nonWearPSleep:</strong> Boolean parameter. If TRUE -&gt; non-wear periods are identified within the sleep periods;otherwise, non-wear periods within the sleep periods are not identified.</li>
<li><strong>nonWearscanParam:</strong> Scan parameter to identify the non-wear periods within sleep periods (axis1, axis2, axis3 or vm).</li>
<li><strong>nonWearInact:</strong> Minimum non-wear period length (in minutes).</li>
<li><strong>nonWearTol:</strong> Maximum minutes of activity (i.e. counts per minute &gt; 0) to declare the end of a non-wear period.</li>
<li><strong>overlap_frac:</strong> Fraction of time to declare a sleep period a non-wear period. If the overlap_frac of a sleep period is identified as non-wear, the sleep period is marked as non-wear.</li>
</ul>
<p>Additionally, the function <code>setActivity()</code> adds the activity label to the <em>activity</em> column between the intervals in the data frame given as parameter.</p>
<pre><code>sleep &lt;- sleepPeriods(data=data60,sleepOnsetHours= c(19,5),
                    bedTimemin = 5,
                    minSleepTime = 160,
                    tolMatrix = matrix(c(0,5,20,
                                         5,19,10,
                                         19,24,20),3,3,byrow=T),
                    tolBsleepMatrix = matrix(c(0,24,10),1,3,byrow=T),
                    scanParam = &quot;axis1&quot;,
                    nonWearPSleep = T, nonWearscanParam = &quot;axis1&quot;,nonWearInact = 90, 
                    nonWearTol = 2,
                    overlap_frac = 0.9)
 data60 &lt;- setActivity(label=&quot;sleep&quot;,intv=sleep$sleep,data60)
 data60 &lt;- setActivity(label=&quot;non-wear&quot;,intv=sleep$sleepnw,data60)</code></pre>
</div>
<div id="non-wear-period-identification" class="section level3">
<h3><span class="header-section-number">4.5.5</span> Non-wear period identification</h3>
<p>In this block the non-wear periods are identified over the unlabeled minutes. The function <code>nonWearPeriods()</code> receives as parameter the data frame, the scan parameter used to identify the non-wear periods, the minimum number of minutes to identify a non-wear period and the tolerance.</p>
<pre><code>nWP &lt;- nonWearPeriods(data60, scanParam=&quot;axis1&quot;,innactivity=20,tolerance=0) #nonWearPeriods. Innactivity and tolerance in minutes
data60 &lt;- setActivity(&quot;non-wear&quot;,nWP,data60)</code></pre>
</div>
<div id="wear-periods-check" class="section level3">
<h3><span class="header-section-number">4.5.6</span> Wear periods check</h3>
<p>The following function search for count per epoch greater than the <code>maxcpm</code> parameter. Those epoch are labeled as invalid. Furthermore, the first minutes of the first day of the sample are labeled as “sleep”.</p>
<pre><code>data60 &lt;- checkWearPeriods(data60,maxcpm = 20000)</code></pre>
</div>
<div id="cleaning-remove-last-day-of-data-and-more-than-7-days-of-data" class="section level3">
<h3><span class="header-section-number">4.5.7</span> Cleaning (Remove last day of data and more than 7 days of data)</h3>
<p>The function <code>removeData()</code> deletes the days/hours/minutes/seconds (given as parameter) from the data frame.</p>
<pre><code>udays &lt;- unique(as.Date(data60$datetime))
firstday &lt;- min(udays)
lastday &lt;- max(udays)
validdays &lt;- seq(firstday,firstday+6,by=1) 
daystoremove &lt;- udays[!(udays%in%validdays)]
data15 &lt;- removeData(data15,toremove=c(daystoremove,lastday),units=&quot;days&quot;) 
data60 &lt;- removeData(data60,toremove=c(daystoremove,lastday),units=&quot;days&quot;) </code></pre>
</div>
<div id="add-intensity-physical-activity" class="section level3">
<h3><span class="header-section-number">4.5.8</span> Add intensity physical activity</h3>
<p>This block performs two procedures. 1) Add the activity column from the 60sec epoch data frame to the 15sec epoch data frame. 2) Add the physical activity intensity to each epoch using evidence-based cut points. In this case, the Evenson et al. (2008) cut points are used.</p>
<pre><code>data15 &lt;- mergingActivity(data15,data60)
data15$intensityEV &lt;- mapply(cut_points_evenson,epoch=15, data15$axis1)
   </code></pre>
</div>
<div id="get-the-datafile-observation-for-the-final-data-frame-only-wear-periods" class="section level3">
<h3><span class="header-section-number">4.5.9</span> Get the datafile observation for the final data frame (only wear periods)</h3>
<p>Extract all the physical activity intensity related variables for each participant.</p>
<pre><code>ob &lt;- getobs(dbDir,data15, timeunit=&quot;min&quot;)</code></pre>
<p>For further information about the functions and their parameters, you can refer to the function documentation.</p>
<p><em>After compile and load all the fuctions into the</em> <strong><em>workspace</em></strong> <em>, run the function <code>main( )</code> to obtain the final data frame.</em></p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="required-packages.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="script-output.html" class="navigation navigation-next " aria-label="Next page""><i class="fa fa-angle-right"></i></a>

<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
